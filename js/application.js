!function(){}("undefined"==typeof appConfig?this.appConfig={}:appConfig),angular.module("app",["ui.router","tg.extensions","tg.components"]),angular.module("tg.extensions",[]),angular.module("tg.components",[]),angular.module("app").config(["$logProvider",function(e){"use strict";e.debugEnabled(!0)}]),angular.module("app").config(["$stateProvider","$urlRouterProvider",function(e,t){"use strict";t.otherwise("/"),e.state("home",{url:"/",templateUrl:"/view/home/index.html",controller:"HomeController"}).state("extensions",{url:"/extensions",templateUrl:"/view/extensions/index.html"}).state("extensions.tgComponents",{url:"/tgComponents",templateUrl:"/view/extensions/tgComponents.html",controller:"ComponentsController"}).state("components",{url:"/components",templateUrl:"/view/components/index.html"}).state("components.tgTypeahead",{url:"/tgTypeahead",templateUrl:"/view/components/tgTypeahead.html",controller:"TypeaheadController"}).state("components.tgDropdown",{url:"/tgDropdown",templateUrl:"/view/components/tgDropdown.html",controller:"DropdownController"}).state("components.tgTabset",{url:"/tgTabset",templateUrl:"/view/components/tgTabset.html",controller:"TabsetController"})}]),angular.module("app").factory("utilities",[function(){"use strict";function e(e,t){var a;if(angular.isArray(e)){for(var n=0,r=e.length;r>n;n++)if(a=t(e[n],n,e),void 0!==a)return a}else if(angular.isObject(e))for(var o in e)if(a=t(e[o],o,e),void 0!==a)return a}function t(e,t,a){var n=[];return this.each(e,function(r,o){var l=t(r,o,e);void 0!==l&&(a&&-1!==n.indexOf(l)||n.push(l))}),n}function a(e){return!e||0===e.length}function n(e,t){return e&&e.indexOf(t)>-1}return{each:e,select:t,empty:a,has:n}}]),angular.module("app").controller("AppController",["$scope",function(){"use strict"}]),angular.module("app").controller("DropdownController",["$scope",function(){"use strict"}]),angular.module("app").controller("TypeaheadController",["$scope","$q","$filter","$timeout",function(e,t,a,n){"use strict";e.results=[{name:"Qwerty",code:"12345"},{name:"Asdfg",code:"56789"}],e.getResultsAsync=function(r,o){var l=t.defer();return n(function(){var t=a("filter")(e.results,{name:r});0===t.length&&(o.dataSet.data.noResults=!0),l.resolve(t)},2e3),l.promise}}]),angular.module("app").controller("TabsetController",["$scope",function(){"use strict"}]),function(){"use strict";function e(e,t){return{restrict:"A",require:e,transclude:!0,scope:!1,compile:function(){function e(e,a,n,r,o){t&&r&&r.hasOwnProperty(t)&&r[t]({$attachTo:function(e,t){o(t,function(t){e.append(t)})}})}function a(e,t){t.remove()}return{pre:e,post:a}}}}angular.module("tg.components").run(["$templateCache",function(e){e.put("tg-dropdown.tpl.html",'<div class="btn-group tg-dropdown-wrap" data-ng-class="tgDropdownWrapClass">   <div class="tg-dropdown-button" data-ng-class="{ \'disabled\': tgDropdownDisabled }"        data-ng-click="toggleOpenState($event);">       <button class="tg-dropdown-label overflow">           <span style="font-style: italic" class="muted" data-ng-if="!$selectedItem" data-ng-bind-html="tgDropdownPlaceholder"></span>           <span data-tg-dropdown-render-template="$templates.selectedItem">No Template</span>       </button>       <button class="tg-dropdown-caret fa" data-ng-class="$stateHolder.opened ? \'fa-caret-up\' : \'fa-caret-down\'"></button>   </div>   <div data-tg-dropdown-render-template="$templates.popup"></div>'),e.put("tg-dropdown-popup.tpl.html",'<div class="tg-dropdown-menu" data-ng-class="{ \'tg-dropdown-menu-has-search\': !!tgDropdownSearch }" data-ng-show="$stateHolder.opened">   <input type="text" class="tg-dropdown-menu-search" placeholder="{{ tgDropdownSearchPlaceholder }}"        data-ng-model="$stateHolder.filter"        data-ng-change="applyFilter();">   <ul class="dropdown-menu" data-tg-when-scrolled="onPopupScrolled($event);">       <li data-ng-if="$templates.itemHeader">           <div data-tg-dropdown-render-template="$templates.itemHeader">               No Template           </div>       </li>       <li data-ng-repeat="$item in $dataHolder.filteredItems | limitTo:$stateHolder.limit">           <a href="" data-ng-click="selectItem($item);" data-tg-dropdown-render-template="$templates.item">               No Template           </a>       </li>       <li data-ng-if="$stateHolder.filter && $dataHolder.filteredItems == 0">           <a href="" class="overflow">               No match for "{{ $stateHolder.filter }}"           </a>       </li>   </ul></div>'),e.put("tg-dropdown-stage-popup.tpl.html",'<div class="tg-dropdown-menu" data-ng-show="$stateHolder.opened">   <ul class="tg-dropdown-stage-menu">       <li class="tg-dropdown-stage-menu__item-wrap" data-ng-if="$level > 0">           <button class="fa fa-caret-left tg-dropdown-stage-menu__back" data-ng-click="goBack($item)"></button>           <div class="tg-dropdown-stage-menu__item" data-ng-click="goBack($item);">Back</div>       </li>       <li class="tg-dropdown-stage-menu__item-wrap" data-ng-repeat="$item in $dataHolder.filteredItems">           <div class="fa fa-check tg-dropdown-stage-menu__check" style="visibility: hidden;"></div>           <button class="fa fa-caret-right tg-dropdown-stage-menu__forward" data-ng-click="goForward($item)" data-ng-if="hasChilds($item)"></button>           <div class="tg-dropdown-stage-menu__item" data-ng-click="goForward($item);" data-tg-dropdown-render-template="$templates.item" data-ng-class="{ \'m-selectable\': !hasChilds($item) }">No Template</div>       </li>   </ul></div>')}]).directive("tgDropdown",["$tgComponents","$http","$compile","$parse","$templateCache","$filter","$timeout","$document",function(e,t,a,n,r,o,l,i){return{restrict:"A",require:["tgDropdown","?ngModel"],scope:{tgDropdown:"@",tgDropdownPlaceholder:"@",tgDropdownId:"@",tgDropdownWrapClass:"@",tgDropdownTemplateUrl:"@",tgDropdownPopupTemplateUrl:"@",tgDropdownSearch:"=",tgDropdownSearchPlaceholder:"@",tgDropdownFilterBy:"@",tgDropdownOrderBy:"=",tgDropdownLimitStep:"@",tgDropdownSelected:"@",tgDropdownDisabled:"=",tgDropdownAddEmpty:"@",tgDropdownEmptyText:"@"},compile:function(e,s){function d(e,t){var a={};return h.modelMapper.assign(a,t),h.viewMapper.assign(a,e),a[h.itemName]}function p(e,t,a,r){function i(e){return g[h.itemName]=e,m=h.modelMapper(c,g),g[h.itemName]=null,m}var s=r[0],p=r[1],c=e.$parent,u=null,g={},m=null,f=null,$=e.tgDropdownFilterBy?n(e.tgDropdownFilterBy):null,v=parseInt(e.tgDropdownLimitStep)||9999,T=e.tgDropdownSelected?n(e.tgDropdownSelected):angular.noop;"true"===e.tgDropdownAddEmpty&&(f=d(e.tgDropdownEmptyText||null,null)),e.$external=c,e.$templates={main:e.tgDropdownTemplateUrl||"tg-dropdown.tpl.html",popup:e.tgDropdownPopupTemplateUrl||"tg-dropdown-popup.tpl.html",selectedItem:null,itemHeader:null,item:null},e.$stateHolder={opened:!1,limit:v,filter:""},e.$dataHolder={filteredItems:[]},e.$selectedItem=f,e.openPopup=function(){e.$stateHolder.filter="",e.$dataHolder.filteredItems=e.getSource(),e.$dataHolder.filteredItems&&0!==e.$dataHolder.filteredItems.length&&(e.$stateHolder.opened=!0,e.$stateHolder.limit=v,l(function(){e.updateMenu()}))},e.closePopup=function(){e.$stateHolder.opened=!1,e.$stateHolder.limit=v},e.onPopupScrolled=function(){var t=e.$stateHolder.limit+v;t>e.$dataHolder.filteredItems.length&&(t=e.$dataHolder.filteredItems.length),v>t&&(t=v),e.$stateHolder.limit=t},e.toggleOpenState=function(t){e.tgDropdownDisabled||(e.$stateHolder.opened?e.closePopup():e.openPopup()),t.preventDefault()},e.getSource=function(){return u},e.applyFilter=function(){e.$stateHolder.limit=v,e.$dataHolder.filteredItems=o("filter")(u,$({$filter:e.$stateHolder.filter}))},e.refreshSource=function(){if(u=h.source(c),u&&(u&&u.length>0&&e.tgDropdownOrderBy&&(u=o("orderBy")(u,e.tgDropdownOrderBy)),f)){var t=!1;for(var a in u)if(null===i(u[a])){t=!0;break}t||u.unshift(angular.copy(f))}},e.selectItem=function(t){var a=e.selectItemEventPrepare(t);s.trigger("onItemSelecting",a).then(function(){e.closePopup(),t&&(e.hasSelectedAnyItem=!0),e.$selectedItem=t,p&&(m=i(t),p.$setViewValue(m)),s.trigger("onItemSelected",a),T(c,a)})},e.selectItemEventPrepare=function(e){var t={$item:e};return t},e.updateMenu=function(){var a=t.find(".dropdown-menu");if(a.length>0){var n=t.find(".tg-dropdown-menu");n.css("width",a.get(0).offsetWidth),a.scrollTop(0),e.tgDropdownSearch&&n.find("input.tg-dropdown-menu-search").focus()}},e.updateSelectedItemFromModel=function(t,a){if(void 0===t&&null!==f&&(t=null),e.$selectedItem=null,void 0!==t&&a(e.$selectedItem)!==t)for(var n in u)if(angular.equals(a(u[n]),t)){e.$selectedItem=u[n];break}return null!==e.$selectedItem?t:null},p&&p.$formatters.push(function(t){return e.updateSelectedItemFromModel(t,i)}),e.refreshSource()}function c(e,n){t.get(e.$templates.main,{cache:r}).success(function(t){n.append(a(t.trim())(e))});var o=!1,s=function(){o||l(function(){e.closePopup()}),o=!1};i.on("click",s),n.on("click",function(){o=!0}),e.$on("$destroy",function(){i.off("click",s)})}var u=/^\s*(.*?)(?:\s+as\s+(.*?))?\s+for\s+(?:([\$\w][\$\w\d]*))\s+in\s+(.*)$/,g=s.tgDropdown.match(u);if(!g)throw new Error("Expected typeahead specification in form of '_modelValue_ (as _label_)? for _item_ in _collection_' but got '"+s.tgDropdown+"'.");var h={itemName:g[3],source:n(g[4]),viewMapper:n(g[2]||g[1]),modelMapper:n(g[1])};return{pre:p,post:c}},controller:["$scope","$element","$attrs",function(t,a,n){var r=this;r.$type="tgDropdown",r.$name=t.tgDropdownId?t.tgDropdownId:r.$type+"_"+t.$id,r.$scope=t,r.$element=a,r.$attrs=n,r.$supportEvents=!0,this.$setSelectedItemTemplate=function(e){t.$templates.selectedItem=e},this.$setItemHeaderTemplate=function(e){t.$templates.itemHeader=e},this.$setItemTemplate=function(e){t.$templates.item=e},this.refreshSource=function(){t.refreshSource()},this.selectItem=function(e){t.selectItem(e)},this.$overrideFn=function(e,a){var n=t[e]||angular.noop;t[e]=function(){var e,t=this.$baseFn;return this.$baseFn=n,e=a.apply(this,arguments),this.$baseFn=t,e}},e.$addInstance(r),t.$on("$destroy",function(){e.$removeInstance(r)})}]}}]).directive("tgDropdownRenderTemplate",["$http","$compile","$parse","$templateCache",function(e,t,a,n){return{restrict:"A",scope:!1,compile:function(){function r(r,o,l){var i=a(l.tgDropdownRenderTemplate)(r);angular.isString(i)?(o.html(null),e.get(i,{cache:n}).success(function(e){o.append(t(e.trim())(r))})):angular.isObject(i)&&(o.html(null),i.$attachTo(o,r))}return{pre:null,post:r}}}}]).directive("tgDropdownSelectedItemTemplate",[function(){return e("^?tgDropdown","$setSelectedItemTemplate")}]).directive("tgDropdownItemHeaderTemplate",[function(){return e("^?tgDropdown","$setItemHeaderTemplate")}]).directive("tgDropdownItemTemplate",[function(){return e("^?tgDropdown","$setItemTemplate")}]).directive("tgDropdownStage",[function(){return{restrict:"A",require:"tgDropdown",scope:!1,compile:function(){function e(e,t,a,n){e=n.$scope,e.$templates.popup=e.tgDropdownPopupTemplateUrl||"tg-dropdown-stage-popup.tpl.html",e.$paths=[],e.$level=0,n.$overrideFn("openPopup",function(){if(this.$baseFn(),e.$selectedItem){var t=e.collectPaths(e.$selectedItem),a=t.length-1;a>=0?(e.$level=a+1,e.selectItem(t[a])):e.goRoot()}else e.$level=0}),n.$overrideFn("selectItem",function(t){e.hasChilds(t)?e.$dataHolder.filteredItems=t.childs:(e.$paths=e.collectPaths(t),this.$baseFn(t))}),n.$overrideFn("selectItemEventPrepare",function(t){var a=this.$baseFn(t);return a.$paths=e.$paths,a}),n.$overrideFn("updateSelectedItemFromModel",function(t,a){if(void 0!==t&&a(e.$selectedItem)!==t){var n,r=function(o){if(Array.isArray(o))for(var l=0,i=o.length;i>l;l++){if(n=o[l],a(n)===t)return n;if(e.hasChilds(n)&&(n=r(n.childs)))return n}};e.$selectedItem=r(e.getSource())||null,e.$selectedItem&&(e.$paths=e.collectPaths(e.$selectedItem))}return null!==e.$selectedItem?t:null}),e.hasChilds=function(e){return e.hasOwnProperty("childs")&&Array.isArray(e.childs)&&e.childs.length>0},e.goRoot=function(){e.$level=0,e.$dataHolder.filteredItems=e.getSource()},e.goForward=function(t){e.$level=e.getItemLevel(t)+1,e.$level>=0?e.selectItem(t):e.goRoot()},e.goBack=function(t){var a=e.collectPaths(t),n=a.length-2;n>=0?(e.$level=n+1,e.selectItem(a[n])):e.goRoot()},e.collectPaths=function(t){var a=[],n=null,r=function(o){var l,i;if(Array.isArray(o))for(l=0,i=o.length;i>l;l++){if(n=o[l],n===t)return n;if(e.hasChilds(n)&&(n=r(n.childs)))return a.unshift(o[l]),n}};return r(e.getSource()),a},e.getItemLevel=function(t){var a=-1,n=null,r=function(o){if(Array.isArray(o))for(var l=0,i=o.length;i>l;l++){if(n=o[l],n===t)return a++,n;if(e.hasChilds(n)&&(n=r(n.childs)))return a++,n}};return r(e.getSource()),a},n.getPaths=function(){return e.$paths}}return{pre:e,post:null}}}}])}(),function(){"use strict";function e(e){return e.replace(t,"\\$1")}var t=/([.?*+^$[\]\\(){}|-])/g;angular.module("tg.components").filter("tgHighlight",[function(){return function(t,a){if(a){var n=new RegExp(e(a),"gi");return t.replace(n,"<strong>$&</strong>")}return t}}]).directive("tgHighlightHtml",["$timeout",function(t){return{restrict:"A",scope:!1,compile:function(){return{pre:angular.noop,post:function(a,n,r){if(r.tgHighlightHtml){var o=e(r.tgHighlightHtml)+"(?!([^<]+)?>)",l=new RegExp(o,"gi");t(function(){n.html(function(e,t){return t.replace(l,"<strong>$&</strong>")})})}}}}}}])}(),function(){"use strict";angular.module("tg.components").run(["$templateCache",function(e){e.put("tg-tabset.tmpl.html",'<div class="tabbable" data-ng-class="tgTabsetWrapClass">   <ul class="nav nav-tabs">       <li data-ng-repeat="$tab in $tabs"           data-ng-class="{ \'active\': isActiveTab($tab), \'disabled\': $tab.disabled }">           <a href="" data-ng-click="setActiveTab($tab);">               <span data-tg-tabset-render-template="$tab.template.header">{{ $tab.title || \'&nbsp;\' }}</span>           </a>       </li>   </ul>   <div class="tab-content" data-ng-repeat="$tab in $tabs">       <div class="tab-pane"            data-ng-if="$tab.initiated"            data-tg-tabset-render-template="$tab.template.content"            data-ng-class="{ \'active\': isActiveTab($tab) }"></div>   </div></div>')}]).directive("tgTabset",["$tgComponents","$http","$compile","$parse","$templateCache","$q",function(e,t,a,n,r,o){return{restrict:"A",scope:{tgTabset:"=?",tgTabsetId:"@",tgTabsetTemplateUrl:"@",tgTabsetWrapClass:"@",tgTabsetActiveTab:"@",tgTabsetContext:"@"},compile:function(){return function(e,o){var l=e.$parent,i=e.tgTabset;e.$tabs=i.$tabs,e.setActiveTab=function(e){i.setActiveTab(e)},e.isActiveTab=function(e){return e&&i.getActiveTab()===e};var s=n(e.tgTabsetTemplateUrl)(l)||"tg-tabset.tmpl.html";t.get(s,{cache:r}).success(function(t){var n=a(t.trim())(e);o.prepend(n)})}},controller:["$scope","$element","$attrs",function(t,a,r){function l(e){for(var t in s)if(s[t].name===e)return!1;return!0}this.$type="tgTabset",this.$name=t.tgTabsetId?t.tgTabsetId:this.$type+"_"+t.$id,this.$scope=t,this.$element=a,this.$attrs=r,this.$supportEvents=!0;var i=this,s=this.$tabs=[],d=null,p=t.tgTabsetActiveTab;t.tgTabset=i,this.context=n(t.tgTabsetContext)(t.$parent)||{},this.getActiveTab=function(){return d},this.setActiveTab=function(e){var t=o.defer();if(!e||-1===s.indexOf(e))throw t.reject(),new Error("Invalid tab.");if(e===d||e.disabled)t.reject();else{e.refreshContext(!1);var a=function(){var a={tab:e,activeTab:d};i.trigger("$onTabSelecting",a).then(function(){e.initiated=!0,e.autoRefresh&&e.refresh(),d&&(a={tab:d},i.trigger("$onTabDeselected",a)),d=e,a={tab:d},i.trigger("$onTabSelected",a),t.resolve()}).catch(function(){t.reject()})};if(d){var n={tab:d};i.trigger("$onTabDeselecting",n).then(function(){a()}).catch(function(){t.reject()})}else a()}return t.promise},this.addTab=function(e){if(!l(e.name))throw new Error("Tab with name `"+e.name+"` was already added to tabset.");var t={tab:e};i.trigger("$onTabAdding",t).then(function(){s.push(e),i.trigger("$onTabAdded",t),e.name===p&&i.setActiveTab(e)})},this.getTabByIndex=function(e,t){var a=s.length;if(e>=0||a>e)return s[e];if(t)throw new Error("Invalid tab index.");return null},this.getTabByName=function(e,t){for(var a in s)if(s[a].name===e)return s[a];if(t)throw new Error("Invalid tab name.");return null},this.setDefaultTab=function(e){p=e},e.$addInstance(this),t.$on("$destroy",function(){e.$removeInstance(i)})}]}}]).directive("tgTabsetRenderTemplate",["$http","$compile","$parse","$templateCache",function(e,t,a,n){return{restrict:"A",scope:!1,compile:function(){function r(r,o,l){var i=a(l.tgTabsetRenderTemplate)(r);i&&angular.isObject(i)&&(i.hasOwnProperty("templateUrl")?(o.html(null),e.get(i.templateUrl,{cache:n}).success(function(e){var a=t(e.trim());o.append(a(i.scope))})):i.hasOwnProperty("$attachTo")&&(o.html(null),i.$attachTo(o,r,null)))}return{pre:null,post:r}}}}]).directive("tgTab",["$parse",function(e){return{restrict:"A",require:"^tgTabset",transclude:!0,scope:{tgTab:"@",tgTabTitle:"@",tgTabContext:"@",tgTabInitiated:"@",tgTabDisabled:"@",tgTabAutoRefresh:"@",tgTabIsolated:"@",tgTabTemplateUrl:"@"},compile:function(){function e(e,t,a,n,r){var o=null,l=e.$tab;l.template.content.$attachTo=function(t,a){var i={tab:l};n.trigger("$onTabAttaching",i).then(function(){o=t;var s="true"===e.tgTabIsolated?a:e.$parent.$new();s.$external=e.$parent,s.$tabset=n,s.$tab=l,r(s,function(e){t.append(e)}),n.trigger("$onTabAttached",i)})},l.refresh=function(){if(l.initiated&&o){var e={tab:l};n.trigger("$onTabRefreshing",e).then(function(){o.html(null),l.$attachTo(o),n.trigger("$onTabRefreshed",e)})}},n.addTab(l),a.$observe("tgTabTitle",function(e){l.title=e}),t.remove()}return{pre:e,post:null}},controller:["$scope","$element","$attrs",function(t){var a=e(t.tgTabContext);t.$tab={name:t.tgTab,title:t.tgTabTitle,template:{header:t.tgTabTemplateUrl?{templateUrl:t.tgTabTemplateUrl,scope:t.$parent}:null,content:{}},context:null,initiated:"true"===t.tgTabInitiated,disabled:"true"===t.tgTabDisabled,autoRefresh:"true"===t.tgTabAutoRefresh,refreshContext:function(e){var n=a(t.$parent)||{};e===!1&&(n=angular.extend(n,this.context)),this.context=n}},t.$tab.refreshContext()}]}}])}(),function(){"use strict";function e(e,t){return{restrict:"A",require:e,transclude:!0,scope:!1,compile:function(){function e(e,a,n,r,o){t&&r&&r.hasOwnProperty(t)&&r[t]({$attachTo:function(e,t){o(t,function(t){e.append(t)})}})}function a(e,t){t.remove()}return{pre:e,post:a}}}}angular.module("tg.components").run(["$templateCache",function(e){e.put("tg-typeahead.tpl.html",'<div class="tg-typeahead"     data-ng-class="tgTypeaheadWrapClass">   <div class="tg-typeahead__input-wrap"        data-ng-show="$isVisibleInput()">       <input type="text" class="tg-typeahead__input"              placeholder="{{ tgTypeaheadPlaceholder || \'\' }}"              data-ng-model="$term"              data-ng-disabled="$stateHolder.disabled">   </div>   <div data-tg-typeahead-render-template="$templates.loader"></div>   <div class="tg-typeahead__suggestions-wrap"        data-tg-typeahead-render-template="$templates.popup.container"        data-tg-typeahead-render-template-to-body="$templates.popup.appendToBody"        data-tg-typeahead-render-template-callback="$onTemplateRender($element, \'popup\');"></div>   <div class="tg-typeahead__suggestions-wrap"        data-ng-if="$stateHolder.hasSuggestions"        data-tg-typeahead-render-template="$templates.suggestedPopup.container"        data-tg-typeahead-render-template-to-body="$templates.suggestedPopup.appendToBody"        data-tg-typeahead-render-template-callback="$onTemplateRender($element, \'suggestedPopup\');"></div></div>'),e.put("tg-typeahead-loader.tpl.html",'<div class="input-loader tg-typeahead__loader"     data-ng-show="$stateHolder.loader"></div>'),e.put("tg-typeahead-popup.tpl.html",'<ul class="tg-typeahead__suggestions"    data-ng-if="$stateHolder.popup.opened"    data-ng-style="$templates.popup.style">    <li class="tg-typeahead__suggestions-header"        data-tg-typeahead-render-template="$templates.popup.header"></li>    <li class="tg-typeahead__suggestions-container"        data-tg-when-scrolled="$onPopupScrolled($event);">        <div data-ng-repeat="$dataSet in $dataSets | filter:{ queried: { active: true } }">            <div class="tg-typeahead__suggestions-group-header"                 data-tg-typeahead-render-template="$dataSet.templates.header || $templates.dataSet.header"></div>            <ul class="tg-typeahead__suggestions-group">                <li class="tg-typeahead__suggestions-group-item"                    data-ng-repeat="$match in $dataSet.queried.matches | limitTo:$dataSet.queried.limit"                    data-ng-class="{ active: $index === $dataSet.queried.activeIndex, selected: $match.selected, disabled: $match.disabled }"                    data-ng-mouseenter="$setActiveMatch($dataSet, $index);"                    data-ng-mouseleave="$dataSet.queried.activeIndex = -1;"                    data-ng-mousedown="!$match.disabled && $selectMatch($dataSet, $index, $match);">                    <div data-tg-typeahead-render-template="$dataSet.templates.item || $templates.dataSet.item"></div>                </li>            </ul>            <div class="tg-typeahead__suggestions-group-footer"                data-tg-typeahead-render-template="$dataSet.templates.footer || $templates.dataSet.footer"></div>        </div>    </li>    <li class="tg-typeahead__suggestions-footer"        data-tg-typeahead-render-template="$templates.popup.footer"></li></ul>'),e.put("tg-typeahead-dataSet-item.tpl.html",'<span data-bind-html-unsafe="$match.value"></span>'),e.put("tg-typeahead-suggested-popup.tpl.html",'<ul class="tg-typeahead__suggestions"    data-ng-if="$stateHolder.suggestedPopup.opened"    data-ng-style="$templates.suggestedPopup.style">    <li class="tg-typeahead__suggestions-header"        data-tg-typeahead-render-template="$templates.suggestedPopup.header"></li>    <li class="tg-typeahead__suggestions-container"        data-tg-when-scrolled="$onPopupScrolled($event);">        <div data-ng-repeat="$dataSet in $dataSets | filter:{ suggested: { active: true } }">            <div class="tg-typeahead__suggestions-group-header"                 data-tg-typeahead-render-template="$dataSet.templates.header || $templates.dataSet.header"></div>            <ul class="tg-typeahead__suggestions-group">                <li class="tg-typeahead__suggestions-group-item"                    data-ng-repeat="$match in $dataSet.suggested.matches | limitTo:$dataSet.suggested.limit"                    data-ng-class="{ active: $index === $dataSet.suggested.activeIndex, selected: $match.selected, disabled: $match.disabled }"                    data-ng-mouseenter="$setActiveMatch($dataSet, $index);"                    data-ng-mouseleave="$dataSet.suggested.activeIndex = -1;"                    data-ng-mousedown="!$match.disabled && $selectMatch($dataSet, $index, $match);">                    <div data-tg-typeahead-render-template="$dataSet.templates.item || $templates.dataSet.item"></div>                </li>            </ul>            <div class="tg-typeahead__suggestions-group-footer"                data-tg-typeahead-render-template="$dataSet.templates.footer || $templates.dataSet.footer"></div>        </div>    </li>    <li class="tg-typeahead__suggestions-footer"        data-tg-typeahead-render-template="$templates.suggestedPopup.footer"></li></ul>'),e.put("tg-typeahead-suggested-dataSet-item.tpl.html",'<span data-bind-html-unsafe="$match.value"></span>'),e.put("tg-typeahead-tag-manager.tpl.html",'<div class="tg-typeahead__tab-manager">   <div data-ng-repeat="$tag in $tags">       <div data-tg-typeahead-render-template="$templates.tag"></div>   </div></div>'),e.put("tg-typeahead-tag.tpl.html",'<div class="tg-typeahead__tag">    <span class="tg-typeahead__tag-remove fa fa-times" rel="tooltip"       data-tooltip-placement="right"       data-tooltip-html-unsafe="delete"       data-ng-click="removeTag($tag)"></span>    <span class="tg-typeahead__tag-name" data-bind-html-unsafe="$tag.match.value"></span></div>'),e.put("tg-typeahead-filter-manager.tpl.html",'<div class="tg-typeahead__tab-manager">   <div data-ng-repeat="$filterTag in $filters.tags">       <div data-tg-typeahead-render-template="$templates.filterTag"></div>   </div></div>'),e.put("tg-typeahead-filter-tag.tpl.html",'<div class="tg-typeahead__tag-wrap">    <div style="display: table-cell; vertical-align: top;" data-ng-switch="!!$filterTag.match">        <div class="tg-typeahead__tag-filter" data-ng-switch-when="true" data-bind-html-unsafe="$filterTag.filter.value"></div>        <select class="tg-typeahead__tag-filter"                data-ng-model="$filterTag.filter"                data-ng-change="$onFilterTypeSelect($filterTag, $filterTag.filter);"                data-ng-options="filter.value for filter in $filterTag.filters track by filter.type"                data-ng-switch-default=""></select>    </div>    <div class="tg-typeahead__tag" style="display: table-cell; vertical-align: top;" data-ng-show="$filterTag.match !== null">       <span class="tg-typeahead__tag-remove fa fa-times" rel="tooltip"             data-tooltip-placement="right"             data-tooltip-html-unsafe="delete"             data-ng-click="removeFilterTag($filterTag)"></span>       <span class="tg-typeahead__tag-name" data-bind-html-unsafe="$filterTag.match"></span>    </div></div>')}]).directive("tgTypeahead",["$tgComponents","$injector","$http","$compile","$parse","$templateCache","$q","$timeout","$document",function(e,t,a,n,r,o,l,i,s){return{restrict:"A",require:["tgTypeahead","?ngModel"],scope:{tgTypeahead:"@",tgTypeaheadId:"@",tgTypeaheadContext:"=",tgTypeaheadPlaceholder:"@",tgTypeaheadTemplateUrl:"@",tgTypeaheadLoaderTemplateUrl:"@",tgTypeaheadPopupTemplateUrl:"@",tgTypeaheadPopupHeaderTemplateUrl:"@",tgTypeaheadPopupFooterTemplateUrl:"@",tgTypeaheadDataSetsHeaderTemplateUrl:"@",tgTypeaheadDataSetsItemTemplateUrl:"@",tgTypeaheadDataSetsFooterTemplateUrl:"@",tgTypeaheadSuggestedPopupTemplateUrl:"@",tgTypeaheadSuggestedPopupHeaderTemplateUrl:"@",tgTypeaheadSuggestedPopupFooterTemplateUrl:"@",tgTypeaheadPopupAppendToBody:"@",tgTypeaheadPopupStrictWidth:"@",tgTypeaheadWrapClass:"@",tgTypeaheadMinLength:"=?",tgTypeaheadDelay:"=?",tgTypeaheadSelected:"@"},priority:4,compile:function(e,d){function p(e){return e&&e.hasOwnProperty("then")&&angular.isFunction(e.then)}function c(e,t,a,n){function o(t){var a=e.$dataHolder.collectedPromises;return e.$dataSets.forEach(function(n){n.data={},n.queried.matches.length=0,n.queried.$hideMore();var r={$queried:!0,$viewValue:t,$internal:e,$context:angular.extend({dataSet:n},e.$prepareSourceContext()||{})},o={},i=n.queried.source,s=i.itemName,c=i.viewMapper,u=i.modelMapper,g=i.sourceMapper,h=g(d,r),m=p(h)?h:l.when(h);m.then(function(a){if(e.$term===t){var r=a;angular.forEach(r,function(e){o[s]=e;var t=new f(e,u(d,o),c(d,o));n.queried.matches.push(t)})}}),a.push(m)}),a}function i(){var t=e.$dataHolder.collectedPromises;return e.$dataSets.forEach(function(a){if(a.suggested&&a.suggested.source){a.data={},a.suggested.matches.length=0,a.suggested.$hideMore();var n={$suggested:!0,$internal:e,$context:angular.extend({dataSet:a},e.$prepareSourceContext()||{})},r={},o=a.suggested.source,i=o.itemName,s=o.viewMapper,c=o.modelMapper,u=o.sourceMapper,g=u(d,n),h=p(g)?g:l.when(g);h.then(function(e){var t=e;angular.forEach(t,function(e){r[i]=e;var t=new $(e,c(d,r),s(d,r));a.suggested.matches.push(t)})}),t.push(h)}}),t}function s(){e.$dataHolder.collectedPromises.length=0}var d=e.$external=e.$parent,c=n[0],u=n[1];e.selectedDataSet=null,e.$dataSets=[],e.$term="",e.$templates={main:e.tgTypeaheadTemplateUrl||"tg-typeahead.tpl.html",popup:{appendToBody:"true"===e.tgTypeaheadPopupAppendToBody,strictWidth:"false"!==e.tgTypeaheadPopupStrictWidth,style:{},element:null,container:e.tgTypeaheadPopupTemplateUrl||"tg-typeahead-popup.tpl.html",header:e.tgTypeaheadPopupHeaderTemplateUrl||null,footer:e.tgTypeaheadPopupFooterTemplateUrl||null},suggestedPopup:{appendToBody:"true"===e.tgTypeaheadPopupAppendToBody,strictWidth:"false"!==e.tgTypeaheadPopupStrictWidth,style:{},element:null,container:e.tgTypeaheadSuggestedPopupTemplateUrl||"tg-typeahead-suggested-popup.tpl.html",header:e.tgTypeaheadSuggestedPopupHeaderTemplateUrl||null,footer:e.tgTypeaheadSuggestedPopupFooterTemplateUrl||null},loader:e.tgTypeaheadLoaderTemplateUrl||"tg-typeahead-loader.tpl.html",dataSet:{header:e.tgTypeaheadDataSetsHeaderTemplateUrl||null,item:e.tgTypeaheadDataSetsItemTemplateUrl||"tg-typeahead-dataSet-item.tpl.html",footer:e.tgTypeaheadDataSetsFooterTemplateUrl||null}},e.$stateHolder={loader:!1,disabled:!1,popup:{opened:!1},hasSuggestions:!1,suggestedPopup:{opened:!1}},e.$dataHolder={collectedPromises:[],modelValue:null},e.$eventHolder={onMatchSelected:r(e.tgTypeaheadSelected)},e.getDataSetSource=function(t){if(t){var a=e.$stateHolder.popup.opened;return a?t.queried:t.suggested}},e.selectDataSet=function(a,n){var r;e.$dataSets.forEach(function(t){r=e.getDataSetSource(t),r&&(r.$hideMore(),r.active=!a)}),e.selectedDataSet=a,e.selectedDataSet&&(r=e.getDataSetSource(e.selectedDataSet),r.$showMore(),r.active=!0),t.find(".tg-typeahead__suggestions-container").scrollTop(),n&&n.stopPropagation()},e.$openPopup=function(){e.$stateHolder.popup.opened||(e.$stateHolder.popup.opened=!0,e.selectDataSet(null),e.$setActiveMatch(null,-1),e.updatePopupElement(e.$templates.popup))},e.$openSuggestedPopup=function(){e.$stateHolder.suggestedPopup.opened||(e.$stateHolder.suggestedPopup.opened=!0,e.selectDataSet(null),e.$setActiveMatch(null,-1),e.updatePopupElement(e.$templates.suggestedPopup))},e.$closePopup=function(){e.$stateHolder.popup.opened&&(e.$stateHolder.popup.opened=!1),e.$stateHolder.suggestedPopup.opened&&(e.$stateHolder.suggestedPopup.opened=!1),e.$cancelAllRequests()},e.$isVisibleInput=function(){return!0},e.$updateInputElement=function(){},e.$prepareSourceContext=function(){},e.$resolveSources=function(t){e.$cancelAllRequests(),e.$stateHolder.loader=!0,l.all(o(t)).then(function(){e.$dataHolder.collectedPromises.length>0&&(s(),e.$openPopup())},function(){e.$cancelAllRequests()}).finally(function(){e.$stateHolder.loader=!1})},e.$resolveSuggestedSources=function(){e.$cancelAllRequests(),e.$stateHolder.loader=!0,l.all(i()).then(function(){e.$dataHolder.collectedPromises.length>0&&(s(),e.$openSuggestedPopup())},function(){e.$cancelAllRequests()}).finally(function(){e.$stateHolder.loader=!1})},e.$cancelAllRequests=function(){e.$stateHolder.loader=!1;var t=e.$dataHolder.collectedPromises;t.length>0&&(t.forEach(function(e){e.hasOwnProperty("cancelRequest")&&e.cancelRequest()}),s())},e.$clearTypeahead=function(){e.$term=""},e.$setActiveMatch=function(t,a){var n;e.$dataSets.forEach(function(r){n=e.getDataSetSource(r),n&&(n.activeIndex=r===t?a:-1)})},e.$selectMatch=function(t,a,n){var r={context:e.tgTypeaheadContext,dataSet:t,index:a,match:n};c.trigger("onMatchSelecting",r).then(function(){e.$term=r.match.value,e.$applyMatch(t,r.match.model),c.trigger("onMatchSelected",r),e.$eventHolder.onMatchSelected(d,r)}),e.$closePopup()},e.$selectUnknownMatch=function(t,a){e.$selectMatch(t,-1,a)},e.$applyMatch=function(t,a){var n=a;e.$dataSets.length>1&&(n=e.$getModel()||{},e.$dataSets.forEach(function(e){n[e.name]=e===t?a:null})),e.$setModel(n)},e.$prepareDefaultModel=function(){var t=e.$dataSets.length>1,a=null;return t&&(a={},e.$dataSets.forEach(function(e){a[e.name]=null})),a},e.$prepareModel=function(t){if(void 0===t)return e.$prepareDefaultModel();var a=null,n=1===e.$dataSets.length,r=e.$dataSets.length>1;if(n?a=e.$dataSets[0]:r&&(t&&!Array.isArray(t)&&angular.isObject(t)||(t={}),e.$dataSets.forEach(function(e){t.hasOwnProperty(e.name)||(t[e.name]=null),null!==t[e.name]&&void 0!==t[e.name]&&(a=e)})),null!==a){var o={},l=a.queried.source.itemName,i=a.queried.source.viewMapper;o[l]=n?t:t[a.name],e.$term=i(e.$parent,o)}return t},e.$getModel=function(){return h?h(d):void 0},e.$setModel=function(t,a){e.$dataHolder.modelValue=t,!a&&u&&u.$setViewValue(null),m&&m(d,t)
},e.$waitTill=function(t){t&&t.hasOwnProperty("finally")&&(e.$closePopup(),e.$stateHolder.loader=!0,e.$stateHolder.disabled=!0,t.finally(function(){e.$stateHolder.loader=!1,e.$stateHolder.disabled=!1}))},e.$onPopupScrolled=function(){if(e.selectedDataSet){var t=e.getDataSetSource(e.selectedDataSet);t.$showMore()}},e.$onOutsideClick=function(){null===e.$dataHolder.modelValue&&e.$clearTypeahead(),e.$closePopup()},e.$onTemplateRender=function(t,a){switch(a){case"popup":e.$templates.popup.element=t[0];break;case"suggestedPopup":e.$templates.suggestedPopup.element=t[0]}},e.$trigger=c.trigger.bind(c)}function u(e,t,r,l){function d(){var t,a=e.$stateHolder.popup.opened,n=e.$stateHolder.suggestedPopup.opened;if(a?t=e.$templates.popup.element:n&&(t=e.$templates.suggestedPopup.element),t){var r=t.find(".tg-typeahead__suggestions-container"),o=r.get(0);if(o&&o.clientHeight<o.scrollHeight){var l=t.find(".tg-typeahead__suggestions-group-item.active"),i=l.get(0);if(i){var s=o.getBoundingClientRect(),d=i.getBoundingClientRect();d.top<s.top?o.scrollTop+=d.top-s.top:d.bottom>s.bottom&&(o.scrollTop+=d.bottom-s.bottom)}}}}var p=l[0],c=(e.$parent,e.tgTypeaheadMinLength||0),u=e.tgTypeaheadDelay||500,h=null,m=null,f=null;e.updatePopupElement=function(e){var a=e.style;if(e.appendToBody){var n=t.offset(),r=t.outerHeight(!0);a.position="absolute",a.top=n.top+r+1,a.left=n.left}e.strictWidth&&(a.width=t.innerWidth(),a.boxSizing="border-box")},a.get(e.$templates.main,{cache:o}).success(function(a){t.append(n(a.trim())(e)),m=t.find(".tg-typeahead__input"),m.on("click",function(){var t=e.$stateHolder.popup.opened;e.$closePopup(),e.$stateHolder.hasSuggestions&&!t&&e.$resolveSuggestedSources()}),f=m.controller("ngModel"),f.$parsers.unshift(function(t){return t=t||"",h&&i.cancel(h),e.$closePopup(),e.$applyMatch(null,null),t.length>=c&&(h=i(function(){""!==e.$term&&e.$resolveSources(t)},u)),t}),p.trigger("onTemplateInit",{element:t})});var $=function(a){if(0===t.has(a.target).length){var n=e.$templates.popup.element,r=e.$templates.suggestedPopup.element;(n&&0===n.has(a.target).length||r&&0===r.has(a.target).length)&&(e.$onOutsideClick(),e.$digest())}},v=function(t){var a=e.$stateHolder.popup.opened,n=e.$stateHolder.suggestedPopup.opened;if((a||n)&&-1!==g.indexOf(t.which)){var r,o=null,l=null,s=null;if(e.selectedDataSet?o=e.selectedDataSet:(e.$dataSets.forEach(function(t){r=e.getDataSetSource(t),r&&-1!==r.activeIndex?o=t:o?o&&!s&&(s=t):l=t}),o||(o=e.$dataSets[0])),t.preventDefault(),r=e.getDataSetSource(o),40===t.which){var p=Math.min(r.limit,r.matches.length);if(r.activeIndex+1<p)r.activeIndex++;else{if(!s)return;e.$setActiveMatch(s,0)}i(d),e.$digest()}else if(38===t.which){if(r.activeIndex>0)r.activeIndex--;else{if(!l)return;if(r=e.getDataSetSource(l)){var p=Math.min(r.limit,r.matches.length);e.$setActiveMatch(l,p-1)}}i(d),e.$digest()}else 13===t.which?null!==o&&(e.$selectMatch(o,r.activeIndex,r.matches[r.activeIndex]),e.$apply()):27===t.which&&(e.$clearTypeahead(),e.$closePopup(),e.$digest())}};s.on("click",$),s.on("keydown",v),e.$on("$destroy",function(){s.off("click",$),s.off("keydown",v)});var T=e.$prepareModel(e.$getModel());e.$setModel(T,!0)}var g=[9,13,27,38,40],h=r(d.ngModel),m=h.assign,f=t.get("tgTypeaheadMatchModel"),$=t.get("tgTypeaheadSuggestedMatchModel");return{pre:c,post:u}},controller:["$scope","$element","$attrs",function(t,a,n){var r=this;r.$type="tgTypeahead",r.$name=t.tgTypeaheadId?t.tgTypeaheadId:r.$type+"_"+t.$id,r.$scope=t,r.$element=a,r.$attrs=n,r.$supportEvents=!0,this.$setPopupHeaderTemplate=function(e){t.$templates.popup.header=e},this.$setPopupFooterTemplate=function(e){t.$templates.popup.footer=e},this.$setSuggestedPopupHeaderTemplate=function(e){t.$templates.suggestedPopup.header=e},this.$setSuggestedPopupFooterTemplate=function(e){t.$templates.suggestedPopup.footer=e},this.$addDataSet=function(e){t.$dataSets.push(e),e.suggested&&(t.$stateHolder.hasSuggestions=!0)},this.$overrideFn=function(e,a){var n=t[e]||angular.noop;t[e]=function(){var e,t=this.$baseFn;return this.$baseFn=n,e=a.apply(this,arguments),this.$baseFn=t,e}},this.clear=function(){t.$clearTypeahead()},e.$addInstance(r),t.$on("$destroy",function(){e.$removeInstance(r)})}]}}]).directive("tgTypeaheadDataSet",["$injector","$parse",function(e,t){return{restrict:"A",require:"^tgTypeahead",scope:{tgTypeaheadDataSet:"@",tgTypeaheadDataSetName:"@",tgTypeaheadDataSetHeaderTemplateUrl:"@",tgTypeaheadDataSetItemTemplateUrl:"@",tgTypeaheadDataSetFooterTemplateUrl:"@",tgTypeaheadDataSetLimitStep:"@",tgTypeaheadDataSetDisplayedItems:"@",tgTypeaheadDataSetSuggested:"@"},compile:function(){function a(e){var a=e.match(o);if(!a)throw new Error("Expected typeahead specification in form of '_modelValue_ (as _label_)? for _item_ in _collection_' but got '"+e+"'.");return{itemName:a[3],sourceMapper:t(a[4]),viewMapper:t(a[2]||a[1]),modelMapper:t(a[1])}}function n(n,r,o,l){var i=parseInt(n.tgTypeaheadDataSetLimitStep)||9999,s=parseInt(n.tgTypeaheadDataSetDisplayedItems)||i,d=a(n.tgTypeaheadDataSet),p=null,c=e.get("tgTypeaheadSourceModel");n.tgTypeaheadDataSetSuggested&&(p={itemName:d.itemName,sourceMapper:t(n.tgTypeaheadDataSetSuggested),viewMapper:d.viewMapper,modelMapper:d.modelMapper}),n.$dataSet={name:n.tgTypeaheadDataSetName||"dataSet_"+n.$id,data:null,templates:{header:n.tgTypeaheadDataSetHeaderTemplateUrl||null,item:n.tgTypeaheadDataSetItemTemplateUrl||null,footer:n.tgTypeaheadDataSetFooterTemplateUrl||null},queried:new c(d,s,i),suggested:p?new c(p,s,i):null},l.$addDataSet(n.$dataSet)}function r(e,t){e.$destroy(),t.remove()}var o=/^\s*(.*?)(?:\s+as\s+(.*?))?\s+for\s+(?:([\$\w][\$\w\d]*))\s+in\s+(.*)$/;return{pre:n,post:r}},controller:["$scope",function(e){this.$setHeaderTemplate=function(t){e.$dataSet.templates.header=t},this.$setItemTemplate=function(t){e.$dataSet.templates.item=t},this.$setFooterTemplate=function(t){e.$dataSet.templates.footer=t}}]}}]).directive("tgTypeaheadPopupHeader",[function(){return e("^?tgTypeahead","$setPopupHeaderTemplate")}]).directive("tgTypeaheadPopupFooter",[function(){return e("^?tgTypeahead","$setPopupFooterTemplate")}]).directive("tgTypeaheadDataSetHeader",[function(){return e("^?tgTypeaheadDataSet","$setHeaderTemplate")}]).directive("tgTypeaheadDataSetItem",[function(){return e("^?tgTypeaheadDataSet","$setItemTemplate")}]).directive("tgTypeaheadDataSetFooter",[function(){return e("^?tgTypeaheadDataSet","$setFooterTemplate")}]).directive("tgTypeaheadSuggestedPopupHeader",[function(){return e("^?tgTypeahead","$setSuggestedPopupHeaderTemplate")}]).directive("tgTypeaheadSuggestedPopupFooter",[function(){return e("^?tgTypeahead","$setSuggestedPopupFooterTemplate")}]).directive("tgTypeaheadRenderTemplate",["$http","$compile","$parse","$templateCache",function(e,t,a,n){return{restrict:"A",scope:!1,compile:function(r,o){function l(a,r){r.html(null);var o=i(a),l=s(a)===!0;angular.isString(o)?e.get(o,{cache:n}).success(function(e){r.append(t(e.trim())(a)),l&&r.detach().appendTo("body"),d(a,{$element:[r]})}):angular.isObject(o)?(o.$attachTo(r,a),l&&r.detach().appendTo("body"),d(a,{$element:[r]})):r.remove()}var i=a(o.tgTypeaheadRenderTemplate),s=a(o.tgTypeaheadRenderTemplateToBody),d=a(o.tgTypeaheadRenderTemplateCallback);return{pre:null,post:l}}}}]).directive("tgTypeaheadTagManager",["$injector","$http","$compile","$parse","$templateCache","$q","$timeout",function(e,t,a,n,r,o,l){return{restrict:"A",require:["tgTypeahead","?ngModel"],scope:!1,priority:3,compile:function(n,i){function s(e,n,i,s){var m=(e.$parent,s[0]),f=s[1];e=m.$scope;var $=null,v=null;e.$tags=[],e.$templates.tagManager=d,e.$templates.tag=p,e.canAddTag=function(){return 0===u||u>e.$tags.length},e.addTag=function(t){if(t&&t.match&&!t.match.selected&&e.canAddTag()){var a={context:e.tgTypeaheadContext,tag:t};return m.events.emit("onTagAdding",a).then(function(){if(t.match.selected=!0,t.dataSet){var n=e.$getModel(),r=n;r&&(e.$dataSets.length>1&&(r=r[t.dataSet.name]),-1===r.indexOf(t.match.data)&&r.push(t.match.data))}return e.$tags.push(t),m.events.emit("onTagAdded",a),t})}return o.when(void 0)},e.removeTag=function(t){var a=e.$tags.indexOf(t);if(-1!==a){var n={context:e.tgTypeaheadContext,index:a,tag:t};return m.events.emit("onTagRemoving",n).then(function(){if(t.match.selected=!1,t.dataSet){var r=e.$getModel(),o=r;if(e.$dataSets.length>1&&o&&(o=o[t.dataSet.name]),o){var l=o.indexOf(t.match.data);-1!==l&&o.splice(l,1)}}e.$tags.splice(a,1),m.events.emit("onTagRemoved",n)})}return o.when(!1)},e.findTag=function(t){for(var a=0,n=e.$tags.length;n>a;a++)if(e.$tags[a].match.data===t.data)return e.$tags[a]},e.clearTags=function(){e.$tags.length=0},e.selectAll=function(t,a){var n=e.getDataSetSource(t);n.matches.forEach(function(a,n){a.selected||e.$selectMatch(t,n,a)}),a&&a.stopPropagation()},e.deselectAll=function(t,a){var n=e.getDataSetSource(t);n.matches.forEach(function(a,n){a.selected&&e.$selectMatch(t,n,a)}),a&&a.stopPropagation()},m.$overrideFn("$applyMatch",function(e,t,a){a&&this.$baseFn(e,t)}),m.$overrideFn("$onOutsideClick",function(){e.$clearTypeahead(),this.$baseFn()}),m.$overrideFn("$isVisibleInput",function(){var t=this.$baseFn();return t&&u>0&&u<=e.$tags.length&&(t=!1),t&&e.$updateInputElement(),t}),m.$overrideFn("$selectMatch",function(t,a,n){var r={context:e.tgTypeaheadContext,dataSet:t,index:a,match:n};m.trigger("onMatchSelecting",r).then(function(){if(c&&1!==e.getDataSetSource(t).matches.length){var a=e.findTag(n);if(void 0===a){var a=new h(n,t);e.addTag(a)}else e.removeTag(a)}else{var a=new h(n,t);e.addTag(a),e.$onOutsideClick()}})}),m.$overrideFn("$prepareDefaultModel",function(){var t=1===e.$dataSets.length,a=e.$dataSets.length>1,n=null;return t?n=[]:a&&(n={},e.$dataSets.forEach(function(e){n[e.name]=[]})),n}),m.$overrideFn("$prepareModel",function(t){if(void 0===t)return e.$prepareDefaultModel();var a=1===e.$dataSets.length,n=e.$dataSets.length>1,r=[];if(a?Array.isArray(t)&&t.length>0&&r.push({dataSet:e.$dataSets[0],source:t}):n&&(t&&!Array.isArray(t)&&angular.isObject(t)||(t={}),e.$dataSets.forEach(function(e){t.hasOwnProperty(e.name)&&Array.isArray(t[e.name])||(t[e.name]=[]),t[e.name].length>0&&r.push({dataSet:e,source:t[e.name]})})),r.length>0){var o={};r.forEach(function(t){var a=t.dataSet,n=a.queried.source,r=n.itemName,l=n.modelMapper,i=n.viewMapper;t.source.forEach(function(t){o[r]=t;var n=new g(t,l(e.$parent,o),i(e.$parent,o)),s=new h(n,a);e.addTag(s)})})}return t}),m.$overrideFn("$updateInputElement",function(){var e=$.width(),t=function(){var t,a,n=0;return $.find(".tg-typeahead__tag").each(function(){t=angular.element(this),a=t.outerWidth()+parseInt(t.css("margin-left"))+parseInt(t.css("margin-right")),n+=a,n>e&&(n=a)}),n}();if(t>0){var a=e-t,n=100>a?e:a;n>=9&&(n-=9),v.css("width",n+"px")}else v.css("width","100%")}),m.events.on("onTemplateInit",function(n){t.get(e.$templates.tagManager,{cache:r}).success(function(t){$=n.element.find(".tg-typeahead"),v=n.element.find(".tg-typeahead__input-wrap"),$.prepend(a(t.trim())(e))})}),m.getTags=function(){var t=[];return e.$tags.forEach(function(e){t.push(e)}),t},m.addTag=function(t,a){var n=new h(t,a);return e.addTag(n)},m.removeTag=function(t){return e.removeTag(t)},m.clearTags=function(){e.clearTags()},e.$watch("$tags",function(e){l(function(){i.required&&f.$setValidity("tagsRequired",0!==e.length)})},!0)}var d=i.tgTypeaheadTagManagerTemplateUrl||"tg-typeahead-tag-manager.tpl.html",p=i.tgTypeaheadTagTemplateUrl||"tg-typeahead-tag.tpl.html",c="true"===i.tgTypeaheadMultiSelection,u=parseInt(i.tgTypeaheadMaxSelectedTags)||0,g=e.get("tgTypeaheadMatchModel"),h=e.get("tgTypeaheadTagModel");return{pre:s,post:null}},controller:[function(){}]}}]).directive("tgTypeaheadFilterManager",["$injector","$http","$q","$templateCache","$compile",function(e,t,a,n,r){return{restrict:"A",require:["tgTypeahead"],scope:!1,priority:2,compile:function(o,l){function i(e,o,l,i){var u=i[0];e=u.$scope,e.$templates.filterManager=s,e.$templates.filterTag=d,e.$filters={tags:[],active:null},e.initFilterManager=function(){e.clearFilterTags(),e.$clearTypeahead(),e.addFilterTag(new c(null)).then(function(t){e.$filters.active=t})},e.canAddFilterTag=function(){return 0===p||p>e.$filters.tags.length},e.addFilterTag=function(t){if(t&&!t.match&&e.canAddFilterTag()){var n={context:e.tgTypeaheadContext,filterTag:t};return u.events.emit("onFilterTagAdding",n).then(function(){return e.$filters.tags.push(t),u.events.emit("onFilterTagAdded",n),t})}return a.when(void 0)},e.removeFilterTag=function(t){var n=e.$filters.tags.indexOf(t);if(-1!==n){var r={context:e.tgTypeaheadContext,filterTag:t};return u.events.emit("onFilterTagRemoving",r).then(function(){return e.$filters.tags.splice(n,1),e.selectFilterMatch(null,t),u.events.emit("onFilterTagRemoved",r),!0})}return a.when(!1)},e.clearFilterTags=function(){e.$filters.tags.length=0},e.selectFilterMatch=function(t,a){if(a=a||e.$filters.active){a.match=t;var n=null,r=e.$filters.tags.length;r>0&&(n=e.$filters.tags[r-1]),(!n||n.match)&&e.addFilterTag(new c(null)).then(function(t){e.$filters.active=t})}e.$clearTypeahead(),e.$closePopup()},e.getAppliedFilters=function(){var t=[];return e.$filters.tags.forEach(function(e){e.filter&&e.match&&t.push({type:e.filter.type,value:e.match,tag:e})}),t},e.$onFilterTypeSelect=function(t,a){var n={context:e.tgTypeaheadContext,filterTag:t,filter:a};return u.events.emit("onFilterTypeSelecting",n).then(function(){u.events.emit("onFilterTypeSelected",n)})},u.$overrideFn("$prepareSourceContext",function(){return{filters:e.getAppliedFilters(),currentFilter:e.$filters.active}}),u.$overrideFn("$isVisibleInput",function(){var t=this.$baseFn(),a=0;return t&&(e.$filters.tags.forEach(function(e){e.match&&a++}),p>0&&a>=p&&(t=!1)),t&&e.$updateInputElement(),t}),u.$overrideFn("$updateInputElement",function(){var e=o.find(".tg-typeahead"),t=o.find(".tg-typeahead__input-wrap"),a=e.width(),n=function(){var t,n,r=0;return e.find(".tg-typeahead__tag-wrap").each(function(){t=angular.element(this),n=t.outerWidth()+parseInt(t.css("margin-left"))+parseInt(t.css("margin-right")),r+=n,r>a&&(r=n)}),r}();if(n>0){var r=a-n,l=100>r?a:r;l>=15&&(l-=15),t.css("width",l+"px")}else t.css("width","100%")}),u.events.on("onTemplateInit",function(a){t.get(e.$templates.filterManager,{cache:n}).success(function(t){var n=a.element.find(".tg-typeahead");n.prepend(r(t.trim())(e))})}),u.events.on("onMatchSelected",function(){e.clearFilterTags()}),u.initFilterManager=function(){e.initFilterManager()},u.getAppliedFilters=function(){return e.getAppliedFilters()},u.getCurrentFilter=function(){return e.$filter.active},e.$watch("$filters.tags",function(t){var a={context:e.tgTypeaheadContext,filterTags:t};u.events.emit("onFilterTagsChange",a)},!0),e.initFilterManager()}var s=l.tgTypeaheadFilterManagerTemplateUrl||"tg-typeahead-filter-manager.tpl.html",d=l.tgTypeaheadFilterTagTemplateUrl||"tg-typeahead-filter-tag.tpl.html",p=parseInt(l.tgTypeaheadMaxUsedFilters)||0,c=e.get("tgTypeaheadFilterTagModel");return{pre:i,post:null}}}}]).factory("tgTypeaheadSourceModel",[function(){function e(e,t,a){this.source=e,this.matches=[],this.displayedItems=t,this.limitStep=a,this.limit=t,this.active=!0,this.activeIndex=-1,this.$hasMore=function(){return this.limit<this.matches.length},this.$showAll=function(e){this.limit=this.matches.length,e&&e.stopPropagation()},this.$showMore=function(e){var t=this.limit+this.limitStep;t>this.matches.length&&(t=this.matches.length),t<this.limitStep&&(t=this.limitStep),this.limit=t,e&&e.stopPropagation()},this.$hideMore=function(e){this.limit=this.displayedItems,e&&e.stopPropagation()}}return e}]).factory("tgTypeaheadMatchModel",[function(){function e(e,t,a){this.data=e,this.model=t,this.value=a,this.selected=!1,this.disabled=!1}return e}]).factory("tgTypeaheadSuggestedMatchModel",[function(){function e(e,t,a){this.data=e,this.model=t,this.value=a,this.selected=!1,this.disabled=!1,this.suggested=!0}return e}]).factory("tgTypeaheadTagModel",[function(){function e(e,t){this.match=e,this.dataSet=t}return e}]).factory("tgTypeaheadFilterTagModel",[function(){function e(e){this.match=e,this.filter=null,this.filters=[]}return e}])}(),function(){"use strict";angular.module("tg.components").directive("tgWhenScrolled",["$parse",function(e){return{restrict:"A",link:function(t,a,n){var r=e(n.tgWhenScrolled);a.bind("scroll",function(e){this.scrollTop+this.offsetHeight>=this.scrollHeight&&(r(t,{$event:e}),t.$digest())})}}}])}(),angular.module("app").controller("ComponentsController",["$scope",function(){"use strict"}]),angular.module("tg.extensions").factory("$tgComponents",["tgEventsProcessor",function(e){"use strict";var t={},a=e.new();return{$addInstance:function(n){if(!n||!n.$name)throw new Error("Invalid instance or instance name.");if(t.hasOwnProperty(n.$name))throw new Error("Component with instance name `"+n.$name+"` already exist.");n.$supportEvents&&!n.hasOwnProperty("events")&&(n.events=e.new(),n.trigger=function(){var e=[];return Array.prototype.push.apply(e,arguments),e.push(n),n.events.emit.apply(n.events,e)}),t[n.$name]=n,a.emit("$onInstanceAdded",n)},$removeInstance:function(e){if(!e||!e.$name)throw new Error("Invalid instance or instance name.");if(!t.hasOwnProperty(e.$name))throw new Error("Component with instance name `"+e.$name+"` doesn't exist.");delete t[e.$name],a.emit("$onInstanceRemoved",e)},hasInstance:function(e){if(!e)throw new Error("Invalid instance name.");return t.hasOwnProperty(e)},getInstance:function(e){if(!this.hasInstance(e))throw new Error("Component with instance name `"+e+"` doesn't exist.");return t[e]||null},getInstances:function(){var e=[];for(var a in t)e.push(t[a]);return e},events:a}}]).factory("tgEventsProcessor",["$q",function(e){"use strict";function t(){this.handlers={},this.on=function(e,t){if(angular.isString(e)&&e.length>0&&angular.isFunction(t)){this.handlers.hasOwnProperty(e)||(this.handlers[e]=[]);var a=this.handlers[e];return a.push(t),function(){var e=a.indexOf(t);-1!==e&&a.splice(e,1)}}},this.emit=function(t){var a=[];if(angular.isString(t)&&t.length>0&&this.handlers.hasOwnProperty(t)){var n=[];Array.prototype.push.apply(n,arguments),n.shift(),angular.forEach(this.handlers[t],function(e){var t=e.apply(this,n);if(t){var r=t.hasOwnProperty("then")&&angular.isFunction(t.then);r&&a.push(t)}})}return e.all(a)},this.clear=function(e,t){if(void 0!==e){if(angular.isString(e)&&e.length>0)if(angular.isFunction(t)){var a=this.handlers[e].indexOf(t);-1!==a&&this.handlers[e].splice(a,1)}else delete this.handlers[e]}else this.handlers={}}}return{"new":function(){return new t}}}]),angular.module("app").controller("HomeController",["$scope",function(){"use strict"}]);